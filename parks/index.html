<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="/assets/css/tailwind.css" />
    <title>Parks.pt</title>
    <script src="//unpkg.com/alpinejs" defer></script>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
      crossorigin=""
    ></script>
  </head>
  <body>
    <nav class="flex flex-row mt-2 mb-2">
  <div class="pl-2 flex-grow text-lg font-bold"><a href="/">Parks.pt</a></div>
  <label class="flex cursor-pointer gap-2">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="20"
      height="20"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <circle cx="12" cy="12" r="5" />
      <path
        d="M12 1v2M12 21v2M4.2 4.2l1.4 1.4M18.4 18.4l1.4 1.4M1 12h2M21 12h2M4.2 19.8l1.4-1.4M18.4 5.6l1.4-1.4"
      />
    </svg>
    <input type="checkbox" value="dark" class="toggle theme-controller" />
    <svg
      xmlns="http://www.w3.org/2000/svg"
      width="20"
      height="20"
      viewBox="0 0 24 24"
      fill="none"
      stroke="currentColor"
      stroke-width="2"
      stroke-linecap="round"
      stroke-linejoin="round"
    >
      <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
    </svg>
  </label>
</nav>

    <div
      class="container mx-auto"
      x-data="parks"
      x-init="getData('child')"
      x-effect="updateMapMarkers(filteredParks())"
    >
      <div class="w-full h-16 bg-gray-300 flex">
        <div class="dropdown z-[999]">
          <div tabindex="0" role="button" class="btn btn-outline m-1">
            Equipment
            <svg
              fill="#000000"
              height="20px"
              width="20px"
              version="1.1"
              id="Layer_1"
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              viewBox="0 0 330 330"
              xml:space="preserve"
            >
              <path
                id="XMLID_225_"
                d="M325.607,79.393c-5.857-5.857-15.355-5.858-21.213,0.001l-139.39,139.393L25.607,79.393
	c-5.857-5.857-15.355-5.858-21.213,0.001c-5.858,5.858-5.858,15.355,0,21.213l150.004,150c2.813,2.813,6.628,4.393,10.606,4.393
	s7.794-1.581,10.606-4.394l149.996-150C331.465,94.749,331.465,85.251,325.607,79.393z"
              />
            </svg>
          </div>
          <div
            tabindex="0"
            class="form-control dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52"
          >
            
            <label class="label cursor-pointer">
              <span class="label-text">Swings</span>
              <input
                type="checkbox"
                class="checkbox"
                value="swing"
                x-model="filter.equipment"
              />
            </label>
            
            <label class="label cursor-pointer">
              <span class="label-text">Slides</span>
              <input
                type="checkbox"
                class="checkbox"
                value="slide"
                x-model="filter.equipment"
              />
            </label>
            
            <label class="label cursor-pointer">
              <span class="label-text">Play House</span>
              <input
                type="checkbox"
                class="checkbox"
                value="play-house"
                x-model="filter.equipment"
              />
            </label>
            
          </div>
        </div>
        <div class="dropdown z-[999]">
          <div tabindex="0" role="button" class="btn btn-outline m-1">
            Facilities
            <svg
              fill="#000000"
              height="20px"
              width="20px"
              version="1.1"
              id="Layer_1"
              xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink"
              viewBox="0 0 330 330"
              xml:space="preserve"
            >
              <path
                id="XMLID_225_"
                d="M325.607,79.393c-5.857-5.857-15.355-5.858-21.213,0.001l-139.39,139.393L25.607,79.393
	c-5.857-5.857-15.355-5.858-21.213,0.001c-5.858,5.858-5.858,15.355,0,21.213l150.004,150c2.813,2.813,6.628,4.393,10.606,4.393
	s7.794-1.581,10.606-4.394l149.996-150C331.465,94.749,331.465,85.251,325.607,79.393z"
              />
            </svg>
          </div>
          <div
            tabindex="0"
            class="form-control dropdown-content z-[1] menu p-2 shadow bg-base-100 rounded-box w-52"
          >
            
            <label class="label cursor-pointer">
              <span class="label-text">Water Fountain</span>
              <input
                type="checkbox"
                class="checkbox"
                value="water-fountain"
                x-model="filter.facilities"
              />
            </label>
            
            <label class="label cursor-pointer">
              <span class="label-text">Sitting</span>
              <input
                type="checkbox"
                class="checkbox"
                value="seating"
                x-model="filter.facilities"
              />
            </label>
            
            <label class="label cursor-pointer">
              <span class="label-text">Tree shade</span>
              <input
                type="checkbox"
                class="checkbox"
                value="tree-cover"
                x-model="filter.facilities"
              />
            </label>
            
          </div>
        </div>
        <button
          class="btn btn-circle"
          x-show="isListView"
          x-on:click="isListView = false"
        >
          Map
        </button>
        <button
          class="btn btn-circle"
          x-show="!isListView"
          x-on:click="isListView = true"
        >
          List
        </button>
      </div>
      <div class="flex flex-col gap-4 p-2">
        <div x-show="isLoading">Loading ...</div>
        <div x-show="isListView">
          <template
            x-for="park in filteredParks"
            x-bind:key="park.name"
            x-show="!isLoading"
          >
            <div class="w-full shrink-0 mb-4">
              <a x-bind:href="park.url">
                <img
                  class="object-cover rounded-lg w-full h-72 mb-2"
                  x-bind:src="'/assets/images' + park.url + '01.jpg'"
                />
                <div class="font-bold text-sm" x-text="park.name"></div>
                <div
                  class="text-sm"
                  x-text="`${park.filterMatches} ${park.location_street_address}, ${park.location_city}`"
                ></div>
              </a>
            </div>
          </template>
        </div>
        <div x-show="!isListView" class="relative">
          <div id="map" class="absolute top-0 left-0 w-screen h-screen"></div>
        </div>
      </div>
    </div>

    <script>
      const map = L.map("map").setView([41.5551463, -8.41272], 13);
      L.tileLayer("https://tile.openstreetmap.org/{z}/{x}/{y}.png", {
        maxZoom: 19,
        attribution:
          '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
      }).addTo(map);

      document.addEventListener("alpine:init", () => {
        Alpine.data("parks", () => ({
          data: [],
          isLoading: false,
          isListView: true,
          filterType: "child",
          filter: { facilities: [], equipment: [] },
          filteredParks() {
            return this.data
              .map((park) => {
                const facilitiesMatched = this.filter.facilities.every((f) =>
                  park.facilities.includes(f)
                );
                const equipmentMatched = this.filter.equipment.every((e) =>
                  park.equipment.includes(e)
                );

                return {
                  ...park,
                  filtersMatched: facilitiesMatched && equipmentMatched,
                };
              })
              .filter((park) => park.filtersMatched);
          },
          updateMapMarkers(filteredParks) {
            for (park of this.data) {
              if (
                filteredParks.some(
                  (filteredPark) => park.url === filteredPark.url
                )
              ) {
                if (!map.hasLayer(park.mapMarker)) {
                  map.addLayer(park.mapMarker);
                }
              } else {
                if (map.hasLayer(park.mapMarker)) {
                  map.removeLayer(park.mapMarker);
                }
              }
            }
          },
          getData(filterType) {
            this.filterType = filterType;
            this.isLoading = true;
            fetch("/parks-all.json")
              .then((response) => response.json())
              .then((data) => {
                this.data = data.map((park) => ({
                  ...park,
                  mapMarker: new L.marker([park.latitude, park.longitude]),
                }));
                this.isLoading = false;
              });
          },
        }));
      });
    </script>
  </body>
</html>
